---

- include: base.yml

- name: "Create User"
  postgresql_user:
    name="{{ database.db_user }}"
    password="{{ database.db_passwd }}"
    role_attr_flags="NOSUPERUSER,CREATEDB"
  become_user: postgres
  become: yes
  when: "{{ database.db_user }} is defined and {{ database.db_passwd }} is defined"

- name: "Create Database"
  postgresql_db:
    name="{{ database.db_name }}"
    login_user="{{database.db_user}}"
    login_password="{{ database.db_passwd }}"
    login_host=127.0.0.1
    encoding='UTF-8'
    template='template0'
    state=present
    owner="{{database.db_user}}"
    lc_ctype='de_DE.UTF-8'
    lc_collate='de_DE.UTF-8'
  when: "{{ database.db_name }} is defined and {{ database.db_user }} is defined and {{ database.db_passwd }} is defined"

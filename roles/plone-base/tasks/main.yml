---

- name: Ensure System Dependencies for Plone are installed
  apt: 
    name={{ item }}
    state=present
    update_cache=no
  with_items:
    - python
    - python-dev
    - python-setuptools
    - python-pip
    - python-virtualenv
    # Dependencies for external Version Control Packages
    - git-core
    - subversion
    # Dependencies to compile Plone Components
    - build-essential
    - libssl-dev
    # Dependencies for LDAP-Support
    - libldap2-dev
    - libsasl2-dev
    - libsasl2-modules-ldap
    # Dependencies for Locales / Translations
    - gettext
    - libexpat-dev
    # Dependencies for Pillow / PIL (Python Image Library)
    - libz-dev
    - zlib1g-dev
    - libjpeg-dev
    - libfreetype6-dev
    - libtiff4-dev
    - liblcms2-dev
    - libwebp-dev
    - tcl8.6-dev
    - tk8.6-dev
    # 
    - libreadline-dev
    # Dependencies for lxml
    - libxml2-dev
    - libxslt-dev
    # Dependencies for transformation of Binary Documents (Office, PDF)
    - wv
    - poppler-utils
    # Base Dependencies from Unified Installer
    - curl
    - wget
    - bzip2
    - gzip
  register: dependency
  changed_when: "' 0 newly installed' not in dependency.stdout"
  when: ansible_os_family == "Debian"

- name: Ensure Group plone_group exists
  group:
    name=plone_group
    state=present
    system=yes

- name: Ensure Users plone_buildout and plone_daemon with group plone_group exists
  user:
    name={{ item }}
    state=present
    system=yes
    group=plone_group
    shell=/bin/bash
    createhome=no
    comment="User for Plone"
  with_items:
    - plone_buildout
    - plone_daemon

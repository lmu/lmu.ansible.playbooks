
- name: install supervisor debian/ubuntu
  apt: pkg=supervisor state=latest
  when: ansible_os_family == "Debian"

- name: ensure supervisor conf.d directory exists
  file:
    path=/etc/supervisor/conf.d
    state=directory
    owner=root
    group=root
    mode="u=rwx,g=rx,o=rx"

- name: ensure supervisor log directory exists
  file:
    path=/var/log/supervisor
    state=directory

- name: Copy supervisor global configuration
  template: 
    src=supervisord.conf.j2
    dest=/etc/supervisor/supervisord.conf
    owner=root
    group=root
    mode="u=rw,g=r,o=r"
    validate=""

- name: "Start the Supervisor service and enable on boot"
  service:
    name=supervisor
    state=started
    enabled=yes

